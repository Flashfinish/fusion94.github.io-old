

<!doctype html>
  <!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
  <!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
  <!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
  <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Arduino + Compass Module 3-Axis HMC5883L - Tony Guntharp</title>
    <meta name="author" content="fusion94">
    
    <meta name="description" content="Arduino + Compass Module 3-Axis HMC5883L Nov 29th, 2012 Arduino Open Source Compass Module 3-Axis HMC5883L Comments NOTE: This is a post in a series &hellip;">
    
    <meta name="viewport" content="width=device-width">
    
    <link rel="canonical" href="http://fusion94.org//blog/2012/11/29/arduino-plus-compass-module-3-axis-hmc5883l">
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet">
    <link href="//atom.xml" rel="alternate" title="Tony Guntharp" type="application/atom+xml">
  </head>


  <body >

    <header>
      <div class="grid-wrapper">
  <div class="grid">

    <div class="grid__item two-fifths lap-four-sixths palm-one-whole">
  <a href="/" class="site-title">Tony Guntharp</a>
</div>

<div class="grid__item three-fifths lap-two-sixths palm-one-whole">
  <nav>
    <input type="checkbox" id="toggle">
<label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu"></label>
<ul class="menu pull-right">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/about">About</a></li>
</ul>
  </nav>
</div>

  </div>
</div>
    </header>

    

    <div class="grid-wrapper">
      <div class="grid grid-center">
        
        <div class="grid__item two-thirds lap-one-whole palm-one-whole">
        

          <article class="post">
  <header>
  
  <h1 class="title indent">Arduino + Compass Module 3-Axis HMC5883L</h1>
  

  
  <div class="meta clearfix">
    








  


<time class="pull-left" datetime="2012-11-29T13:14:00-08:00" pubdate data-updated="true"><i class="icon-calendar"></i> Nov 29<span>th</span>, 2012</time>
    



  
  <div class="pull-left">
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      <li><a href="/blog/categories/Arduino/">Arduino</a></li>
    
      <li><a href="/blog/categories/Open Source/">Open Source</a></li>
    
      <li><a href="/blog/categories/Compass Module 3-Axis HMC5883L/">Compass Module 3-Axis HMC5883L</a></li>
    
    </ul>
  </div>
  

    
      <a class="pull-right" href="#disqus_thread">
        Comments <i class="icon-comment"></i>
      </a>
    
  </div>
  
</header>




  <div class="info">NOTE: This is a post in a series of blog posts on how to build electronic circuits. If you’re at 
all interested then please subscribe to the RSS feed.</div>


<h3>Background</h3>

<p>In this blogpost we&rsquo;re going to deal with the <a href="http://www.parallax.com/tabid/768/ProductID/779/Default.aspx">Compass Module 3-Axis HMC5883L</a> from Parallax and how to
integrate it into an Arduino.</p>

<p>The Compass Module 3-Axis HMC5883L is designed for low-field magnetic sensing with a digital interface.
This compact sensor fits into small projects such as UAVs and robot navigation systems.</p>

<!-- more -->


<p>The sensor converts any magnetic field to a differential voltage output on 3 axes. This voltage shift
is the raw digital output value, which can then be used to calculate headings or sense magnetic fields
coming from different directions. Example code in PBASIC, Spin, and C are provided in the downloads.</p>

<p><strong>Features:</strong></p>

<ul>
<li>Measures Earth’s magnetic fields</li>
<li>3-axis magnetoresistive sensor</li>
<li>Wide magnetic field range (+/-8 gauss)</li>
<li>1 to 2 degree compass heading accuracy</li>
<li>Precision in-axis sensitivity and linearity</li>
<li>I2C digital Interface</li>
<li>Fast 160 Hz maximum output rate</li>
<li>Designed for use with a large variety of microcontrollers with different voltage requirements</li>
</ul>


<p><strong>Application Notes:</strong></p>

<ul>
<li>Auto and personal navigation</li>
<li>UAV systems</li>
<li>Robotic navigation</li>
<li>Location-based services (LBS)</li>
</ul>


<p><strong>Key Specifications:</strong></p>

<ul>
<li>Power Requirements: 2.7 to 6.5 VDC</li>
<li>Communication Interface: I2C (up to 400 kHz)</li>
<li>Operating temperature: -22 to +185 °F (-30 to +85 °C)</li>
<li>Dimensions: 0.725 x 0.650 in (1.8 x 1.7 cm)</li>
</ul>


<h3>What It Can Do</h3>

<ul>
<li>Measures the earth’s magnetic field in three axes, with a 1–2 degree accuracy</li>
<li>Provides individual readings for each axis, which may be used separately or together for 3D calculations</li>
<li>Measures raw strength (gauss) of a nearby magnetic source</li>
</ul>


<p>The 3-Axis Compass module measures magnetic fields in three directions – or axes, labeled X, Y, and Z.
In its most simple form, the module can be used as a basic compass to find earth’s magnetic north.</p>

<p>The compass module can also sense the relative strength of a nearby magnetic source, such as those
caused by magnets or electric fields. As the sensor detects magnetism in three dimensions, it can
determine relative distance and direction to these sources.</p>

<p><img src="/images/blog/compass/Compass-2.png"></p>

<p>Compasses are commonly uses with accelerometers, where the data from both the compass and
accelerometer can provide extended information.</p>

<p>One application of adding an accelerometer is to compensate for any tilt of the compass. As with
most any compass, the reading is affected if the compass is not level.</p>

<p><strong>Hardware Required</strong></p>

<ul>
<li>Arduino Board</li>
<li>(1) Compass Module 3-Axis HMC5883L</li>
<li>breadboard</li>
<li>hook-up wire</li>
</ul>


<p><strong>Circuit</strong></p>

<p><img src="/images/blog/compass/Compass-3.png"></p>

<p>Connect the 5V and GND pins of the compass to the power and ground ports on the Arduino. Connect
analog pin 4 of the Arduino to the SDA (Data) out pin of the compass, and analog pin 5 to the SCL
(Clock) out pin.</p>

<p>The picture below shows you essentially how the circuit should be laid out.</p>

<p><img src="/images/blog/compass/Compass-6_0.png"></p>

<p>Don’t forget that your Arduino must be connected to your computer in order for it to transmit serial
data and don’t forget to set the Baud Rate of your serial connection to be 9600.</p>

<p><strong>The Code</strong></p>

<figure class='code'><figcaption><span>Compass Module 3-Axis HMC5883L code for Arduino </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/*
</span><span class='line'>   Compass Module 3-Axis HMC5883L
</span><span class='line'>   
</span><span class='line'>   Read the Compass Module 3-Axis HMC5883L and prints them over the serial connection to the computer.
</span><span class='line'>   
</span><span class='line'>   The circuit:
</span><span class='line'>    * SDA (Data) output of compass to analog pin 4
</span><span class='line'>    * SCL (Clock) output of compass to analog pin 5
</span><span class='line'>    * +V of accelerometer to +5V
</span><span class='line'>    * GND of accelerometer to ground
</span><span class='line'>
</span><span class='line'>   created 29 Nov 2012
</span><span class='line'>   by Tony Guntharp
</span><span class='line'>
</span><span class='line'> */
</span><span class='line'>#include 
</span><span class='line'>
</span><span class='line'>#define Addr 0x1E               // 7-bit address of HMC5883 compass
</span><span class='line'>
</span><span class='line'>void setup() {
</span><span class='line'>  Serial.begin(9600);
</span><span class='line'>  delay(100);                   // Power up delay
</span><span class='line'>  Wire.begin();
</span><span class='line'>  
</span><span class='line'>  // Set operating mode to continuous
</span><span class='line'>  Wire.beginTransmission(Addr); 
</span><span class='line'>  Wire.write(byte(0x02));
</span><span class='line'>  Wire.write(byte(0x00));
</span><span class='line'>  Wire.endTransmission();
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>void loop() {
</span><span class='line'>  int x, y, z;
</span><span class='line'>
</span><span class='line'>  // Initiate communications with compass
</span><span class='line'>  Wire.beginTransmission(Addr);
</span><span class='line'>  Wire.write(byte(0x03));       // Send request to X MSB register
</span><span class='line'>  Wire.endTransmission();
</span><span class='line'>
</span><span class='line'>  Wire.requestFrom(Addr, 6);    // Request 6 bytes; 2 bytes per axis
</span><span class='line'>  if(Wire.available() &lt;=6) {    // If 6 bytes available
</span><span class='line'>    x = Wire.read() &lt;&lt; 8 | Wire.read();
</span><span class='line'>    z = Wire.read() &lt;&lt; 8 | Wire.read();
</span><span class='line'>    y = Wire.read() &lt;&lt; 8 | Wire.read();
</span><span class='line'>  }
</span><span class='line'>  
</span><span class='line'>  // Print raw values
</span><span class='line'>  Serial.print("X=");
</span><span class='line'>  Serial.print(x);
</span><span class='line'>  Serial.print(", Y=");
</span><span class='line'>  Serial.print(y);
</span><span class='line'>  Serial.print(", Z=");
</span><span class='line'>  Serial.println(z);
</span><span class='line'>  
</span><span class='line'>  delay(500);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>At the end of uploading and running the code listed above you will start to see some serial output
like in the image below.</p>

<p><img src="/images/blog/compass/compass_results.png"></p>

<p>Here’s a picture of the actual circuit built.</p>

<p><img src="/images/blog/compass/compass_circuit.png"></p>

<p><strong>Source Code</strong></p>

<p><a href="https://github.com/fusion94/HMC5883L_Arduino">Github</a></p>

<p>In a follow up blog post I’ll discuss how you can use both the Compass Module 3-Axis HMC5883L in
conjunction with the Memsic 2125 Dual-axis Accelerometer to compensate for any tilt of the compass.</p>


</article>

 
<section id="disqus">
  <h1 class="indent title">Comments</h1>
  <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>

        
        </div>
        
        
        <aside id="sidebar" class="grid__item one-third lap-one-whole palm-one-whole">
          <div class="grid">

  
<section class="social aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">
    Follow Me!
  </h1>
  <ul class="unstyled">
    <li><a class="adn" rel="me" href="//alpha.app.net/fusion94"><i class="icon-adn"></i> App.net</a></li>
    
    <li><a class="github" href="//github.com/fusion94"><i class="icon-github"></i> Github</a></li>
    
    <li><a class="gplus" href="//plus.google.com/101024956573508432752"><i class="icon-google-plus-sign"></i> Google+</a></li>
    <li><a class="linkedin" href="//linkedin.com/in/fusion94"><i class="icon-linkedin-sign"></i> LinkedIn</a></li>
    
    
    <li><a class="twitter" href="//twitter.com/fusion94"><i class="icon-twitter"></i> Twitter</a></li>
    
  </ul>
</section>


  <section id="recent-posts" class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">Recent Posts</h1>
  <ul class="divided">
    
      <li class="post">
        <a href="/blog/2014/02/15/hearthstone-beta/">Hearthstone - Beta</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/12/managerial-mistakes/">Managerial Mistakes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/09/top-10-shell-commands-used/">Top 10 Shell Commands used</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/09/an-inconvenient-truth-about-assault-rifles/">An Inconvenient Truth about Assault Rifles</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/06/how-to-enable-developer-settings-on-android-4-dot-2/">How to enable developer settings on Android 4.2</a>
      </li>
    
  </ul>
</section>

<section id="github-repos" class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">
    GitHub Repos
    
    <small class="pull-right">
      <a class="btn" href="//github.com/fusion94" title="@fusion94 on GitHub" target="_blank">
        <i class="icon-external-link"></i>
      </a>
    </small>
    
  </h1>
  <ul id="gh_repos" class="divided">
    <li class="loading">
      <i class="icon-spinner icon-spin"></i>
    </li>
  </ul>
</section>




</div>

        </aside>
        
      </div>
    </div>
    
    <footer>
      <div class="grid-wrapper">
  <div class="grid">
    <div class="grid__item">
      <p class="copyright">
  All content by fusion94 and licenced under <a href="//creativecommons.org/licenses/by-nc-sa/3.0/ie/">Creative Commons</a>.<br>
  Code under <a href="//github.com/coogie/oscailte/blob/master/README.md">MIT Licence</a>.
</p>
    </div>
  </div>
</div>

    </footer>

    <!--[if lt IE 7]>
      <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script src="//crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/md5.js"></script>
<script defer src="/javascripts/octopress.js"></script>


<script>
  var _gaq=[['_setAccount','UA-83223-8'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>



<script>
  var disqus_shortname = 'fusion94org';
  
    
    // var disqus_developer = 1;
    var disqus_identifier = 'http://fusion94.org//blog/2012/11/29/arduino-plus-compass-module-3-axis-hmc5883l/';
    var disqus_url = 'http://fusion94.org//blog/2012/11/29/arduino-plus-compass-module-3-axis-hmc5883l/';
    var disqus_script = 'embed.js';
  
  (function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>




<script>
  $(document).ready(function(){
    if (!window.jXHR){
      var jxhr = document.createElement('script');
      jxhr.type = 'text/javascript';
      jxhr.src = '/javascripts/libs/jXHR.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jxhr, s);
    }

    github.showRepos({
      user: 'fusion94',
      count: 10,
      skip_forks: true,
      target: '#gh_repos'
    });
  });
</script>
<script src="/javascripts/github.js"></script>






  </body>
</html>